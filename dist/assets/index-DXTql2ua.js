(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function i(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(r){if(r.ep)return;r.ep=!0;const t=i(r);fetch(r.href,t)}})();class d{constructor(){this.loadingScreen=null,this.game=null,this.screenManager=null,this.initialized=!1,this.progressIndicator=null,this.backgroundProgress={total:4,completed:0,steps:["Assets","Systems","Game Core","Finalization"]},this.devicePerformance=this.assessDevicePerformance(),this.loadingScreenManager=new(window.LoadingScreenManager||class{}),this.progressIndicatorManager=new(window.ProgressIndicatorManager||class{}),this.assetLoader=new(window.AssetLoader||class{loadCriticalAssets(){return Promise.resolve()}loadScript(){return Promise.resolve()}loadCSS(){return Promise.resolve()}}),this.errorNotificationManager=new(window.ErrorNotificationManager||class{showError(){}})}applyConfigurationOverrides(){}assessDevicePerformance(){const e={score:1,factors:{}};try{if(navigator.hardwareConcurrency){const i=navigator.hardwareConcurrency;e.factors.cores=i,i>=8?e.score+=.3:i>=4?e.score+=.1:i<=2&&(e.score-=.2)}if(navigator.deviceMemory){const i=navigator.deviceMemory;e.factors.memory=i,i>=8?e.score+=.2:i>=4?e.score+=.1:i<=2&&(e.score-=.3)}return e}catch{return e}}async init(){this.showLoadingScreen();try{typeof window.ScreenManager<"u"&&(this.screenManager=new window.ScreenManager),this.ensureMenuVisible("Normal initialization"),this.showBackgroundProgressIndicator(),await this.initializeBackgroundSystems(),this.hideBackgroundProgressIndicator()}catch(e){console.error("[GameBootstrap] Initialization failed:",e),this.showErrorNotification(e),this.ensureMenuVisible("Error initialization path",e)}finally{this.hideLoadingScreen()}}async initializeBackgroundSystems(){try{this.updateBackgroundProgress("Loading critical assets...",1),await this.preloadCriticalAssets(),this.updateBackgroundProgress("Initializing game systems...",2),await this.initializeGame(),this.updateBackgroundProgress("Finalizing systems...",3),await new Promise(e=>setTimeout(e,200)),this.updateBackgroundProgress("Ready!",4)}catch(e){throw this.updateBackgroundProgress(`Failed: ${e.message}`,-1),this.showErrorNotification(e),e}}ensureMenuVisible(e,i=null){this.hideLoadingScreen();const s=this.screenManager||this.game&&this.game.screenManager;if(s&&typeof s.showScreen=="function")try{s.showScreen("main-menu");return}catch{}const r=document.getElementById("loading-screen");r&&(r.style.display="none",r.classList.remove("active"));const t=document.getElementById("main-menu-screen");t&&(t.style.display="flex",t.classList.add("active"))}showLoadingScreen(){if(this.loadingScreenManager&&this.loadingScreenManager.show)this.loadingScreenManager.show();else{const e=document.getElementById("loading-screen");e&&(e.style.display="flex",e.classList.add("active"))}}hideLoadingScreen(){if(this.loadingScreenManager&&this.loadingScreenManager.hide)this.loadingScreenManager.hide();else{const e=document.getElementById("loading-screen");e&&(e.style.display="none",e.classList.remove("active"))}}showBackgroundProgressIndicator(){this.progressIndicatorManager&&this.progressIndicatorManager.show&&this.progressIndicatorManager.show()}hideBackgroundProgressIndicator(){this.progressIndicatorManager&&this.progressIndicatorManager.hide&&this.progressIndicatorManager.hide()}updateBackgroundProgress(e,i){this.progressIndicatorManager&&this.progressIndicatorManager.update&&this.progressIndicatorManager.update(e,i,this.backgroundProgress.total)}showErrorNotification(e){this.errorNotificationManager&&this.errorNotificationManager.showError&&this.errorNotificationManager.showError(e)}async preloadCriticalAssets(){return this.assetLoader.loadCriticalAssets()}loadScript(e){return this.assetLoader.loadScript(e)}loadStylesheet(e){return this.assetLoader.loadCSS(e)}async initializeGame(){if(typeof window.Game>"u")throw new Error("Game class not loaded");const e=document.getElementById("gameCanvas");if(!e)throw new Error("Game canvas not found in DOM");if(this.setupResponsiveCanvas(e),this.game=new window.Game(e),window.game=this.game,!window.camera&&typeof window.Camera<"u"?window.camera=new window.Camera(e):window.camera&&typeof window.camera.setCanvas=="function"&&window.camera.setCanvas(e),this.screenManager&&(this.game.screenManager=this.screenManager),this.setupCanvasResizeHandler(e),await this.game.initialize()===!1)throw new Error("Game initialization returned false");this.initialized=!0}setupResponsiveCanvas(e){try{let i=800,s=600;typeof window.CONFIG<"u"&&window.CONFIG.CANVAS_WIDTH&&window.CONFIG.CANVAS_HEIGHT&&(typeof window.CONFIG.CANVAS_WIDTH=="number"&&window.CONFIG.CANVAS_WIDTH>0&&window.CONFIG.CANVAS_WIDTH<=4096&&(i=window.CONFIG.CANVAS_WIDTH),typeof window.CONFIG.CANVAS_HEIGHT=="number"&&window.CONFIG.CANVAS_HEIGHT>0&&window.CONFIG.CANVAS_HEIGHT<=4096&&(s=window.CONFIG.CANVAS_HEIGHT));const r=e.parentElement;if(r){const t=r.clientWidth,n=r.clientHeight,a=i/s,c=t/n;t>0&&n>0&&(c>a?(s=Math.min(s,n),i=s*a):(i=Math.min(i,t),s=i/a))}e.width=Math.floor(i),e.height=Math.floor(s),e.style.width=i+"px",e.style.height=s+"px"}catch{}}setupCanvasResizeHandler(e){window.addEventListener("resize",()=>{this.setupResponsiveCanvas(e),this.game&&typeof this.game.handleResize=="function"&&this.game.handleResize()})}}window.addEventListener("DOMContentLoaded",()=>{new d().init()});
